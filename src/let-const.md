
## let和const

### 声明变量：
+ var：遇到有var的作用域，在任何语句执行前都已经完成了声明和初始化，也就是变量提升而且拿到undefined的原因由来（var的声明和初始化过程都提升了）
+ let：解析器进入一个块级作用域，发现let关键字，变量只是先完成声明，并没有到初始化那一步。此时如果在此作用域提前访问，则报错xx is not defined，这就是暂时性死区的由来。等到解析到有let那一行的时候，才会进入初始化阶段。如果let的那一行是赋值操作，则初始化和赋值同时进行（ let只是声明过程提升，初始化过程并没有提升）
+ const、class都是同let一样的道理
+ function： 声明、初始化、赋值一开始就全部完成，所以函数的变量提升优先级更高

        debugger
        var a=1;
        const b=2;
        let c=3;
        {
            let d=4;
            const e=a;
            var aa=b;
        }
        function aFun() {
            var aaa = 0
            console.log(a,b,c,aa)
            // console.log(d,e)
        }
        aFun()
        // console.log(aaa)
### JS 引擎中的内存分类：
+ 栈内存（作用域）供js代码执行的环境，保存基本数据类型（boolean,null,undefined,number,string,symbol,bigint）（线性结构，后进先出，便于管理）
+ 堆内存：存储引用数据类型（混沌，杂乱无章，方便存储和开辟内存空间）（ 闭包变量是存在堆内存中的。）

### 内存分配：
+ var：会直接在栈内存里预分配内存空间，然后等到实际语句执行的时候，再存储对应的变量，如果传的是引用类型，那么会在堆内存里开辟一个内存空间存储实际内容，栈内存会存储一个指向堆内存的指针
+ let：是不会在栈内存里预分配内存空间，而且在栈内存分配变量时，做一个检查，如果已经有相同变量名存在就会报错
+ const：也不会预分配内存空间，在栈内存分配变量时也会做同样的检查。不过const存储的变量是不可修改的，对于基本类型来说你无法修改定义的值，对于引用类型来说你无法修改栈内存里分配的指针，但是你可以修改指针指向的对象里面的属性

### 运行时
 在词法环境内部，维护了一个小型栈结构，栈底是函数最外层的变量，进入一个作用域块后，就会把该作用域块内部的变量压到栈顶；当作用域执行完成之后，该作用域的信息就会从栈顶弹出进入块级作用域不会有编译过程，只不过通过let或者const声明的变量会在进入块级作用域的时被创建，但是在该变量没有赋值之前，引用该变量JavaScript引擎会抛出错误---这就是“暂时性死区”。

![Image text](https://user-gold-cdn.xitu.io/2019/3/17/1698ac2c8ca10784?imageslim)

        function foo(b) {
            var a = 5;
            return a * b + 10;
        }
        function bar(x) {
            var y = 3;
            return foo(x*y);
        }
        console.log(bar(6));

![Image text](https://image.fundebug.com/2019-0410-03.png)        
### 回调队列
回调队列会按照添加的顺序存储所有的回调函数，然后等待执行栈为空。当执行栈为空的时候，回调队列会把队列首部的那个回调函数推入执行栈。当执行栈再次为空的时候，再将此时队列首部函数推入。

Note： *队列是一个FIFO的数据结构-先进先出。相比于栈的在尾部添加、移除数据，队列是在尾部添加数据，在首部移除数据。*

### 事件循环
事件循环可以被看作是JS运行时环境中的这样的一个东西：它的工作是持续的检测调用栈和回调队列，如果检测到调用栈为空，它就会通知回调队列把队列中的第一个回调函数推入执行栈。调用栈和执行队列可能在某一段时间内是闲置的，但是事件循环是永不停歇的检测前两者的。在任意时间，只要Web API容器中的事件达到触发条件，就可以把回调函数添加到回调队列中去。

        console.log('Hi');
        setTimeout(function cb1() { 
            console.log('cb1');
        }, 5000);
        console.log('Bye');
![Image text](https://pic1.zhimg.com/v2-3baaa2030f404cf2375836958a3b2584_b.webp)